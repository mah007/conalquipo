<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">

        <record id="stock_automatic_email_template" model="mail.template">
            <field name="model_id" ref="con_stock_mail_automatic.model_stock_picking"/>
            <field name="auto_delete" eval="True"/>
            <field name="name">Send stock moves mail</field>
            <field name="subject">${ctx['subject']}</field>
            <field name="email_from">${ctx['senders'].login}</field>
            <field name="email_to">${ctx['recipients']}</field>
            <field name="body_html"><![CDATA[

% set partners = ctx.get('partner_lst', [])

% set workers = ctx.get('works_lst', [])

% set moves = ctx.get('move_line_ids', [])

% if partners:
    % for linep in partners:
        <table border="1" width="800">
            <tr>
                <th colspan="8" align="left" bgcolor="#FF9238">${linep['name']}</th>
            </tr>
            % if workers:
                % for linew in workers:
                    % if linew['partner_id'].name == linep['name']:
                        <tr>
                            <th colspan="8" bgcolor="#F1F1F1">${linew['name']}</th>
                        </tr>
                        % if moves:
                            <tr>
                                <th align="left" bgcolor="#A9A9A9">Product</th>
                                <th align="left" bgcolor="#A9A9A9">Quantity</th>
                                <th align="left" bgcolor="#A9A9A9">Picking type</th>
                            </tr>
                            % for linem in moves:
                                % for linew in workers:
                                    % if linem['picking_id'].project_id.name == linew['name'] and linew['partner_id'].name == linep['name']:
                                        <tr>         
                                            <td>
                                                ${linem['product_id'].name}
                                            </td>
                                            <td>
                                                ${linem['qty_done']}            
                                            </td>          
                                            <td>
                                                ${linem['picking_id'].picking_type_id.name}
                                            </td>                          
                                        </tr>
                                    % endif
                                % endfor
                            % endfor
                        % endif
                    % endif
                % endfor                        
            % endif
        </table>
    % endfor
% endif

]]></field>

        </record>

    </data>
</odoo>